<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liter√°rn√≠ Rozbor Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        textarea::-webkit-scrollbar { width: 8px; }
        textarea::-webkit-scrollbar-track { background: #f1f1f1; }
        textarea::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 4px; }
        textarea::-webkit-scrollbar-thumb:hover { background: #a8a8a8; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <header class="flex justify-between items-center mb-8 border-b border-slate-200 pb-4">
            <div>
                <h1 class="text-3xl font-bold text-slate-900 tracking-tight">üìù Rozbor Manager</h1>
                <p class="text-sm text-slate-500 mt-1">Auto-save enabled (LocalStorage)</p>
            </div>
            <div class="text-right">
                 <a href="https://github.com/SimonPoky/Literarni-rozbory" target="_blank" class="text-sm font-medium text-blue-600 hover:text-blue-800 transition-colors flex items-center gap-2">
                    <svg height="20" width="20" viewBox="0 0 16 16" fill="currentColor"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg>
                    SimonPoky/Literarni-rozbory
                </a>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <div class="lg:col-span-2 space-y-6">
                <form id="analysis-form" class="space-y-8">
                    <input type="hidden" name="id" id="entry-id">

                    <!-- 1. TEXT A JEHO SLO≈ΩKY -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                        <h2 class="text-xl font-bold text-slate-800 mb-4 border-b pb-2">I. TEXT A JEHO SLO≈ΩKY</h2>
                        
                        <!-- Z√°klad -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                            <div class="col-span-2 md:col-span-1">
                                <label class="block text-sm font-medium text-slate-700 mb-1">N√°zev d√≠la</label>
                                <input type="text" name="title" required class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 border p-2">
                            </div>
                            <div class="col-span-2 md:col-span-1">
                                <label class="block text-sm font-medium text-slate-700 mb-1">Autor</label>
                                <input type="text" name="author" required class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 border p-2">
                            </div>
                        </div>

                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-semibold text-blue-700 mb-1">Liter√°rn√≠ druh a ≈æ√°nr</label>
                                <input type="text" name="genre_type" class="w-full rounded-md border-gray-300 shadow-sm border p-2" placeholder="lyrika, pr√≥za, balada, rom√°n, pov√≠dka...">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-blue-700 mb-1">Kontext</label>
                                <textarea name="context" rows="2" class="w-full rounded-md border-gray-300 shadow-sm border p-2" placeholder="autor, recepce d√≠la, liter√°rn√≠ obdob√≠, liter√°rn√≠ smƒõr..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- OBSAH -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                        <h3 class="text-lg font-bold text-slate-700 mb-4 border-l-4 border-blue-500 pl-3">Obsah</h3>
                        
                        <div class="space-y-5">
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1">T√©ma</label>
                                <textarea name="theme" rows="1" class="w-full rounded-md border-gray-300 shadow-sm border p-2" placeholder="hlavn√≠, vedlej≈°√≠..."></textarea>
                            </div>
                            
                            <div class="pl-4 border-l-2 border-slate-200 space-y-4">
                                <h4 class="text-sm font-bold text-slate-500 uppercase tracking-wide">Vƒõcn√Ω obsah</h4>
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-1">Postavy</label>
                                    <textarea name="characters" rows="2" class="w-full rounded-md border-gray-300 shadow-sm border p-2" placeholder="hlavn√≠/vedlej≈°√≠, charakteristika, v√Ωvoj, vztahy..."></textarea>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-1">Vypravƒõƒç / Lyrick√Ω subjekt</label>
                                    <input type="text" name="narrator" class="w-full rounded-md border-gray-300 shadow-sm border p-2" placeholder="ich-forma, v≈°evƒõdouc√≠, vztah ke ƒçten√°≈ôi...">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-1">ƒåasoprostor</label>
                                    <input type="text" name="setting" class="w-full rounded-md border-gray-300 shadow-sm border p-2" placeholder="ƒças a prost≈ôed√≠ (m√≠stn√≠, soci√°ln√≠)">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-1">Dƒõj / Dƒõn√≠</label>
                                    <textarea name="plot" rows="3" class="w-full rounded-md border-gray-300 shadow-sm border p-2" placeholder="p≈ôevypr√°vƒõn√≠, motivy, z√°pletka, rozuzlen√≠..."></textarea>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-1">My≈°lenkov√Ω a emoƒçn√≠ obsah</label>
                                    <textarea name="thought_content" rows="2" class="w-full rounded-md border-gray-300 shadow-sm border p-2" placeholder="vidƒõn√≠ svƒõta, ponauƒçen√≠, smysl, celkov√© p≈Øsoben√≠..."></textarea>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- FORMA -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                        <h3 class="text-lg font-bold text-slate-700 mb-4 border-l-4 border-blue-500 pl-3">Forma</h3>

                        <div class="space-y-6">
                            <div class="pl-4 border-l-2 border-slate-200 space-y-4">
                                <h4 class="text-sm font-bold text-slate-500 uppercase tracking-wide">Kompozice</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-slate-700 mb-1">ƒålenƒõn√≠ textu</label>
                                        <input type="text" name="composition_structure" class="w-full rounded-md border-gray-300 shadow-sm border p-2" placeholder="kapitoly, strofy, dƒõjstv√≠...">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-slate-700 mb-1">Slohov√© postupy</label>
                                        <input type="text" name="style_procedures" class="w-full rounded-md border-gray-300 shadow-sm border p-2" placeholder="vypr√°vƒõn√≠, popis, √∫vaha, detailnost...">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-slate-700 mb-1">Kompoziƒçn√≠ postupy</label>
                                        <input type="text" name="composition_procedures" class="w-full rounded-md border-gray-300 shadow-sm border p-2" placeholder="chronologick√Ω, retrospektivn√≠...">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-slate-700 mb-1">Kompoziƒçn√≠ principy</label>
                                        <input type="text" name="composition_principles" class="w-full rounded-md border-gray-300 shadow-sm border p-2" placeholder="opakov√°n√≠, kontrast...">
                                    </div>
                                </div>
                            </div>

                            <div class="pl-4 border-l-2 border-slate-200 space-y-4">
                                <h4 class="text-sm font-bold text-slate-500 uppercase tracking-wide">V√Ωrazov√© prost≈ôedky</h4>
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-1">Neverb√°ln√≠</label>
                                    <input type="text" name="nonverbal" class="w-full rounded-md border-gray-300 shadow-sm border p-2" placeholder="ilustrace, grafick√° √∫prava...">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-1">Verb√°ln√≠</label>
                                    <textarea name="verbal" rows="4" class="w-full rounded-md border-gray-300 shadow-sm border p-2" placeholder="spisovnost, archaismy, eufemismy, term√≠ny, syntax, figury, tropy..."></textarea>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 2. KOMENT√Å≈ò -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                        <h2 class="text-xl font-bold text-slate-800 mb-4 border-b pb-2">II. KOMENT√Å≈ò ‚Äì JAK O TEXTU P≈òEM√ù≈†LET</h2>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-semibold text-blue-700 mb-1">Anal√Ωza</label>
                                <p class="text-xs text-slate-500 mb-1">Rozklad textu na slo≈æky a jejich charakteristika.</p>
                                <textarea name="analysis" rows="3" class="w-full rounded-md border-gray-300 shadow-sm border p-2"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-blue-700 mb-1">V√Ωklad (SMYSL/V√ùZNAM)</label>
                                <p class="text-xs text-slate-500 mb-1">PROƒå to tak je? Proƒç autor zvolil tento ≈æ√°nr/t√©ma/kompozici? Smysl postav, ƒçasu, prostoru...</p>
                                <textarea name="interpretation" rows="4" class="w-full rounded-md border-gray-300 shadow-sm border p-2"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-blue-700 mb-1">Hodnocen√≠</label>
                                <p class="text-xs text-slate-500 mb-1">Posouzen√≠ klad≈Ø a z√°por≈Ø.</p>
                                <textarea name="evaluation" rows="2" class="w-full rounded-md border-gray-300 shadow-sm border p-2"></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="flex gap-4 pt-4">
                        <button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg shadow transition-all transform active:scale-[0.98]">
                            üíæ Ulo≈æit Rozbor
                        </button>
                        <button type="button" id="btn-reset" class="px-6 py-3 bg-slate-200 hover:bg-slate-300 text-slate-700 font-medium rounded-lg transition-colors">
                            Nov√Ω
                        </button>
                    </div>
                </form>
            </div>

            <div class="lg:col-span-1">
                <div class="sticky top-8 space-y-6">
                    
                    <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-100">
                         <button type="button" id="btn-save-sidebar" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg shadow transition-all transform active:scale-[0.98] flex items-center justify-center gap-2">
                            üíæ Rychl√© ulo≈æen√≠
                        </button>
                    </div>

                    <div class="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
                        <div class="p-4 border-b border-slate-100 bg-slate-50 flex justify-between items-center">
                            <h3 class="font-semibold text-slate-800">Ulo≈æeno (<span id="count">0</span>)</h3>
                            <button id="btn-nuke" class="text-xs text-red-500 hover:text-red-700 font-medium">Smazat v≈°e</button>
                        </div>
                        <div id="list-container" class="max-h-[60vh] overflow-y-auto divide-y divide-slate-100">
                        </div>
                    </div>

                    <div class="bg-slate-50 rounded-xl border border-slate-200 p-6">
                        <h3 class="font-bold text-lg mb-2 text-slate-700">Export</h3>
                        <p class="text-slate-500 text-sm mb-4">Vygeneruje kompletn√≠ sborn√≠k pro XeLaTeX (Struktura dle ≈°koln√≠ho zad√°n√≠).</p>
                        <button id="btn-generate" class="w-full bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-3 px-4 rounded-lg shadow transition-colors flex items-center justify-center gap-2">
                            <span>‚ö° Generovat LaTeX</span>
                        </button>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <div id="modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl shadow-2xl w-11/12 max-w-4xl flex flex-col max-h-[90vh]">
            <div class="p-4 border-b flex justify-between items-center">
                <h3 class="font-bold text-lg">LaTeX V√Ωstup</h3>
                <button id="btn-close-modal" class="text-slate-400 hover:text-red-500 text-2xl leading-none">&times;</button>
            </div>
            <div class="flex-1 p-0 relative">
                <textarea id="output-code" class="w-full h-full min-h-[400px] p-4 font-mono text-xs bg-slate-50 resize-none focus:outline-none" readonly></textarea>
                <button id="btn-copy" class="absolute top-4 right-4 bg-blue-600 hover:bg-blue-700 text-white text-sm py-1 px-3 rounded shadow">
                    Copy
                </button>
            </div>
        </div>
    </div>

<script>
const DB_KEY = 'maturita_storage_v3';
const form = document.getElementById('analysis-form');
const listContainer = document.getElementById('list-container');
let db = JSON.parse(localStorage.getItem(DB_KEY) || '[]');

const saveToDb = () => {
    try {
        localStorage.setItem(DB_KEY, JSON.stringify(db));
        renderList();
    } catch (e) { alert('LocalStorage full!'); }
};

const renderList = () => {
    document.getElementById('count').textContent = db.length;
    listContainer.innerHTML = db.length ? '' : '<div class="p-4 text-sm text-slate-400 text-center">Zat√≠m nic...</div>';
    
    db.sort((a, b) => a.title.localeCompare(b.title)).forEach((item, idx) => {
        const originalIdx = db.indexOf(item);
        const el = document.createElement('div');
        el.className = 'p-3 hover:bg-blue-50 transition-colors group flex justify-between items-center';
        el.innerHTML = `
            <div class="cursor-pointer flex-1 truncate" onclick="loadEntry(${originalIdx})">
                <div class="font-medium text-slate-800 truncate">${item.title}</div>
                <div class="text-xs text-slate-500 truncate">${item.author}</div>
            </div>
            <button onclick="deleteEntry(${originalIdx})" class="opacity-0 group-hover:opacity-100 text-red-400 hover:text-red-600 p-1 ml-2 transition-opacity" title="Smazat">
                <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M18 6L6 18M6 6l12 12"></path></svg>
            </button>
        `;
        listContainer.appendChild(el);
    });
};

form.addEventListener('submit', (e) => {
    e.preventDefault();
    const formData = new FormData(form);
    const entry = Object.fromEntries(formData.entries());
    const id = formData.get('id');

    if(id !== '') {
        db[parseInt(id)] = entry;
    } else {
        db.push(entry);
    }
    
    saveToDb();
    resetForm();
    showToast(id !== '' ? 'Aktualizov√°no' : 'Ulo≈æeno');
});

document.getElementById('btn-save-sidebar').addEventListener('click', () => {
    form.requestSubmit();
});

window.loadEntry = (idx) => {
    const data = db[idx];
    if(!data) return;
    
    Object.keys(data).forEach(key => {
        const input = form.elements[key];
        if(input) input.value = data[key];
    });
    
    document.getElementById('entry-id').value = idx;
    window.scrollTo({ top: 0, behavior: 'smooth' });
};

window.deleteEntry = (idx) => {
    if(confirm('Smazat nav≈ædy?')) {
        db.splice(idx, 1);
        saveToDb();
        if(document.getElementById('entry-id').value == idx) resetForm();
    }
};

const resetForm = () => {
    form.reset();
    document.getElementById('entry-id').value = '';
};

document.getElementById('btn-reset').onclick = resetForm;
document.getElementById('btn-nuke').onclick = () => {
    if(confirm('V√Å≈ΩNƒö SMAZAT V≈†ECHNO?')) {
        db = [];
        saveToDb();
        resetForm();
    }
};

const esc = (text) => {
    if (!text) return '-';
    return text.replace(/\\/g, '\\textbackslash{}')
               .replace(/&/g, '\\&')
               .replace(/%/g, '\\%')
               .replace(/\$/g, '\\$')
               .replace(/#/g, '\\#')
               .replace(/_/g, '\\_')
               .replace(/{/g, '\\{')
               .replace(/}/g, '\\}')
               .replace(/~/g, '\\textasciitilde{}')
               .replace(/\^/g, '\\textasciicircum{}')
               .replace(/\n/g, '\\\\ ');
};

const genTable = (title, rows) => {
    const lw = '5.5cm'; const cw = '10.5cm';
    let tbl = `\\subsubsection*{${title}}\n\\begin{center}\n\\begin{tabular}{p{${lw}} p{${cw}}}\n\\toprule\\midrule\n`;
    rows.forEach(([k, v]) => { tbl += `\\textbf{${k}:} & \\parbox[t]{${cw}}{${v || '-'}} \\\\ \n\\midrule\n`; });
    tbl += `\\bottomrule\n\\end{tabular}\n\\end{center}\n`;
    return tbl;
};

const generateLatex = () => {
    if(!db.length) return alert('Pr√°zdno. Nic k exportu.');
    const sorted = [...db].sort((a, b) => a.title.localeCompare(b.title));
    
    const content = sorted.map(d => `
\\clearpage
\\section*{Rozbor: ${esc(d.title)}}
\\addcontentsline{toc}{section}{${esc(d.title)} (${esc(d.author)})}

\\begin{center}
    \\Large\\bfseries Charakteristika, anal√Ωza a interpretace umƒõleck√©ho textu \\\\
    \\vspace{0.3cm}
    \\rule{\\textwidth}{1pt} \\normalsize
    \\textbf{D√≠lo:} ${esc(d.title)} \\quad $\\bullet$ \\quad \\textbf{Autor:} ${esc(d.author)}
\\end{center}
\\bigskip

% I. TEXT A JEHO SLO≈ΩKY
\\section*{I. TEXT A JEHO SLO≈ΩKY -- ƒåEHO SI V TEXTU V≈†√çMAT}

\\subsection*{1. Z√°kladn√≠ √∫daje}
\\begin{description}
    \\item[Liter√°rn√≠ druh a ≈æ√°nr:] ${esc(d.genre_type)}
    \\item[Kontext:] ${esc(d.context)}
\\end{description}

\\subsection*{2. Obsah}
\\textbf{T√©ma:} ${esc(d.theme)} \\\\

${genTable('Vƒõcn√Ω obsah', [
    ['Postavy', esc(d.characters)],
    ['Vypravƒõƒç / Lyrick√Ω subjekt', esc(d.narrator)],
    ['ƒåasoprostor', esc(d.setting)],
    ['Dƒõj/dƒõn√≠', esc(d.plot)],
    ['My≈°lenkov√Ω a emoƒçn√≠ obsah', esc(d.thought_content)]
])}

\\subsection*{3. Forma}

${genTable('Kompozice', [
    ['ƒålenƒõn√≠ textu', esc(d.composition_structure)],
    ['Slohov√© postupy', esc(d.style_procedures)],
    ['Kompoziƒçn√≠ postupy', esc(d.composition_procedures)],
    ['Kompoziƒçn√≠ principy', esc(d.composition_principles)]
])}

${genTable('V√Ωrazov√© prost≈ôedky', [
    ['Neverb√°ln√≠', esc(d.nonverbal)],
    ['Verb√°ln√≠', esc(d.verbal)]
])}

% II. KOMENT√Å≈ò
\\section*{II. KOMENT√Å≈ò -- JAK O TEXTU P≈òEM√ù≈†LET}

\\subsection*{Anal√Ωza}
${esc(d.analysis)}

\\subsection*{V√Ωklad}
${esc(d.interpretation)}

\\subsection*{Hodnocen√≠}
${esc(d.evaluation)}

\\vspace{1cm}
\\rule{\\textwidth}{0.2pt}
`).join('');

    const template = `\\documentclass[11pt, a4paper]{article}
\\usepackage[a4paper, top=2.5cm, bottom=2.5cm, left=2cm, right=2cm]{geometry}
\\usepackage{fontspec}
\\usepackage[czech, bidi=basic, provide=*]{babel}
\\babelprovide[import, onchar=ids fonts]{czech}
\\babelfont{rm}{Noto Sans}
\\usepackage{parskip, booktabs, fancyhdr, hyperref, enumitem}
\\hypersetup{colorlinks=true, linkcolor=blue, urlcolor=cyan, pdftitle={Maturitn√≠ Sborn√≠k}}
\\pagestyle{fancy} \\fancyhead[L]{\\nouppercase{\\rightmark}} \\fancyhead[R]{\\thepage} \\fancyfoot{}

\\begin{document}
\\begin{titlepage} \\centering \\vspace*{3cm}
{\\Huge \\bfseries MATURITN√ç SOUBOR DƒöL} \\\\[1.5cm]
{\\large Vygenerov√°no aplikac√≠ Rozbor Manager}
\\end{titlepage}
\\clearpage \\tableofcontents \\clearpage
${content}
\\end{document}`;

    document.getElementById('output-code').value = template;
    document.getElementById('modal').classList.remove('hidden');
    document.getElementById('modal').classList.add('flex');
};

const showToast = (msg) => {
    const t = document.createElement('div');
    t.className = 'fixed bottom-4 right-4 bg-slate-800 text-white px-4 py-2 rounded shadow-lg z-50 text-sm animate-bounce';
    t.innerText = msg;
    document.body.appendChild(t);
    setTimeout(() => t.remove(), 2000);
};

document.getElementById('btn-generate').onclick = generateLatex;
document.getElementById('btn-close-modal').onclick = () => {
    document.getElementById('modal').classList.add('hidden');
    document.getElementById('modal').classList.remove('flex');
};
document.getElementById('btn-copy').onclick = async () => {
    const txt = document.getElementById('output-code');
    txt.select();
    try {
        await navigator.clipboard.writeText(txt.value);
        showToast('Zkop√≠rov√°no!');
    } catch (err) {
        document.execCommand('copy');
        showToast('Zkop√≠rov√°no (fallback)');
    }
};

renderList();
</script>
</body>
</html>
